<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Partida</title>

    <style>
        :root {
            --dimensao: 55px;
        }

        #quadrado {
            width: var(--dimensao);
            height: var(--dimensao);
            background-color: transparent;
            border: 1px solid #fff;
            border-radius: 10px;
            margin: 10px;
        }
    </style>
</head>

<body class="bg-primary">
    <div class="container mt-3">

        <div class="text-light border-bottom p-2 text-center fs-4">
            <%= locals.salaGame.nome %>
        </div>

        <div class="d-flex justify-content-between">
            <div class="d-flex">
                <div>
                    <label for="jogador1" class="text-light">Jogador 1</label>
                    <input class="form-control" type="text" name="jogador1" id="jogador1"
                        value="<%= locals.salaGame.jogador1 %>">
                </div>
                <div id="quadrado"></div>
            </div>


            <div class="d-flex">
                <div id="quadrado"></div>
                <div>
                    <label for="jogador2" class="text-light text-end w-100">Jogador 2</label>
                    <input class="form-control" type="text" name="jogador2" id="jogador2"
                        value="<%= locals.salaGame.jogador2 %>">
                </div>
            </div>

        </div>

        <input type="hidden" name="numJogadores" id="numJogadores" value="<%= locals.salaGame.numJogadores %>">
        <input type="hidden" name="idSala" id="idSala" value="<%= locals.salaGame.id %>">
    </div>

    <!-- <div> meu id: <span></span></div> -->

    <script src="/socket.io/socket.io.js"></script>

    <script>
        const socket = io();
        let nomeJogador;

        function getNameCookie() {
            let cookie = document.cookie;
            let indIgual = cookie.indexOf('=');
            nomeJogador = cookie.substring(indIgual + 1, cookie.length);
        }
        getNameCookie();

        socket.emit('getMyIdSocket', nomeJogador);
        socket.on('getMyId', (idSocket) => {
            document.querySelector('span').innerText = idSocket;
            novaSala.idJ1 = idSocket;
            alert(idSocket);
        });

        let numJogadores = document.getElementById('numJogadores').value;
        let idSala = document.getElementById('idSala').value;
        let nomeSala = document.getElementById('nomeSala').value;

        let novaSala = {
            id: idSala,
            criador: document.getElementById('jogador1').value,
            nome: nomeSala,
            adversario: document.getElementById('numJogadores').value,
            numJogadores: document.getElementById('numJogadores').value,
            jogador1: document.getElementById('jogador1').value,
            jogador2: '',
            idJ1: '',
            idJ2: ''
        }

        alert(numJogadores);
        if (numJogadores == 2) {
            alert('2 Jogadores')
            socket.emit('preencher-2-player-aqui', novaSala, nomeJogador);
        }

        socket.on('nome-2-player-recebido', (nomeJogador) => {
            document.getElementById('jogador2').value = nomeJogador;
            document.getElementById('numJogadores').value = 2;

            socket.emit('avisar-2-player', novaSala);
        });

        socket.on('preencher-seu-2-player', (nomeJogador) => {
            document.getElementById('jogador2').value = nomeJogador;
            document.getElementById('numJogadores').value = 2;
        });

    </script>
</body>

</html>